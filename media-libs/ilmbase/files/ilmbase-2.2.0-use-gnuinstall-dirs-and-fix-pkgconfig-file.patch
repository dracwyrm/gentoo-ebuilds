diff -purN a/CMakeLists.txt b/CMakeLists.txt
--- a/CMakeLists.txt	2014-08-10 05:21:45.000000000 +0100
+++ b/CMakeLists.txt	2017-09-18 17:20:29.302487103 +0100
@@ -22,8 +22,13 @@ set(CPACK_SOURCE_PACKAGE_FILE_NAME
   )
 set(CPACK_SOURCE_IGNORE_FILES
   "/.git*;/.cvs*;${CPACK_SOURCE_IGNORE_FILES}")
+set(CMAKE_THREAD_PREFER_PTHREAD ON)
+
 INCLUDE ( CPack )
+INCLUDE ( GNUInstallDirs )
 
+find_package( PkgConfig QUIET )
+find_package( Threads ) 
 
 # Allow the developer to select if Dynamic or Static libraries are built
 OPTION (BUILD_SHARED_LIBS "Build Shared Libraries" ON)
@@ -44,55 +49,6 @@ INCLUDE_DIRECTORIES ( Iex IexMath Imath
 # also add the current directory to pick up the autogenerated headers
 SET(CMAKE_INCLUDE_CURRENT_DIR ON)
 
-MACRO(GET_TARGET_PROPERTY_WITH_DEFAULT _variable _target _property _default_value)
-   GET_TARGET_PROPERTY (${_variable} ${_target} ${_property})
-   IF (${_variable} MATCHES NOTFOUND)
-     SET (${_variable} ${_default_value})
-   ENDIF (${_variable} MATCHES NOTFOUND)
- ENDMACRO (GET_TARGET_PROPERTY_WITH_DEFAULT)
-
- MACRO(CREATE_LIBTOOL_FILE _target _install_DIR)
-   GET_TARGET_PROPERTY(_target_location ${_target} LOCATION)
-   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_static_lib ${_target} STATIC_LIB "")
-   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_dependency_libs ${_target} LT_DEPENDENCY_LIBS "")
-   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_current ${_target} LT_VERSION_CURRENT 0)
-   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_age ${_target} LT_VERSION_AGE 0)
-   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_revision ${_target} LT_VERSION_REVISION 0)
-   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_installed ${_target} LT_INSTALLED yes)
-   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_shouldnotlink ${_target} LT_SHOULDNOTLINK yes)
-   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_dlopen ${_target} LT_DLOPEN "")
-   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_dlpreopen ${_target} LT_DLPREOPEN "")
-   GET_FILENAME_COMPONENT(_laname ${_target_location} NAME_WE)
-   GET_FILENAME_COMPONENT(_soname ${_target_location} NAME)
-   SET(_laname ${PROJECT_BINARY_DIR}/${_laname}.la)
-   FILE(WRITE ${_laname} "# ${_laname} - a libtool library file\n")
-   FILE(APPEND ${_laname} "# Generated by CMake ${CMAKE_VERSION} (like GNU libtool)\n")
-   FILE(APPEND ${_laname} "\n# Please DO NOT delete this file!\n# It is necessary for linking the library with libtool.\n\n" )
-   FILE(APPEND ${_laname} "# The name that we can dlopen(3).\n")
-   FILE(APPEND ${_laname} "dlname='${_soname}'\n\n")
-   FILE(APPEND ${_laname} "# Names of this library.\n")
-   FILE(APPEND ${_laname} "library_names='${_soname}.${_target_current}.${_target_age}.${_target_revision} ${_soname}.${_target_current} ${_soname}'\n\n")
-   FILE(APPEND ${_laname} "# The name of the static archive.\n")
-   FILE(APPEND ${_laname} "old_library='${_target_static_lib}'\n\n")
-   FILE(APPEND ${_laname} "# Libraries that this one depends upon.\n")
-   FILE(APPEND ${_laname} "dependency_libs='${_target_dependency_libs}'\n\n")
-   FILE(APPEND ${_laname} "# Names of additional weak libraries provided by this library\n")
-   FILE(APPEND ${_laname} "weak_library_names=\n\n")
-   FILE(APPEND ${_laname} "# Version information for ${_laname}.\n")
-   FILE(APPEND ${_laname} "current=${_target_current}\n")
-   FILE(APPEND ${_laname} "age=${_target_age}\n")
-   FILE(APPEND ${_laname} "revision=${_target_revision}\n\n")
-   FILE(APPEND ${_laname} "# Is this an already installed library?\n")
-   FILE(APPEND ${_laname} "installed=${_target_installed}\n\n")
-   FILE(APPEND ${_laname} "# Should we warn about portability when linking against -modules?\n")
-   FILE(APPEND ${_laname} "shouldnotlink=${_target_shouldnotlink}\n\n")
-   FILE(APPEND ${_laname} "# Files to dlopen/dlpreopen\n")
-   FILE(APPEND ${_laname} "dlopen='${_target_dlopen}'\n")
-   FILE(APPEND ${_laname} "dlpreopen='${_target_dlpreopen}'\n\n")
-   FILE(APPEND ${_laname} "# Directory that this library needs to be installed in:\n")
-   FILE(APPEND ${_laname} "libdir='${CMAKE_INSTALL_PREFIX}${_install_DIR}'\n")
-   INSTALL( FILES ${_laname} DESTINATION ${CMAKE_INSTALL_PREFIX}${_install_DIR})
- ENDMACRO(CREATE_LIBTOOL_FILE)
 
 SET (LIB_TYPE STATIC)
 IF (BUILD_SHARED_LIBS)
@@ -188,13 +144,6 @@ SET_TARGET_PROPERTIES ( IexMath
   OUTPUT_NAME "IexMath${ILMBASE_LIBSUFFIX}"
   )
 
-IF ( NOT WIN32 )
-  CREATE_LIBTOOL_FILE ( Half /lib )
-  CREATE_LIBTOOL_FILE ( Iex /lib )
-  CREATE_LIBTOOL_FILE ( IexMath /lib )
-  CREATE_LIBTOOL_FILE ( Imath /lib )
-  CREATE_LIBTOOL_FILE ( IlmThread /lib )
-ENDIF ()
 
 # Tests
 
@@ -207,25 +156,11 @@ ADD_SUBDIRECTORY ( ImathTest )
 INSTALL ( FILES 
   ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h
   DESTINATION
-  include/OpenEXR
+  ${CMAKE_INSTALL_INCLUDEDIR}/OpenEXR
 
 )
 
-FILE ( WRITE ${CMAKE_BINARY_DIR}/IlmBase.pc "prefix=${CMAKE_INSTALL_PREFIX}\n" )
-FILE ( APPEND ${CMAKE_BINARY_DIR}/IlmBase.pc "exec_prefix=\${prefix}
-libdir=\${exec_prefix}/lib
-includedir=\${prefix}/include
-OpenEXR_includedir=\${prefix}/include/OpenEXR
-
-Name: IlmBase
-Description: Base math and exception libraries
-Version: ${ILMBASE_VERSION}
-Libs: -L\${libdir} -lImath${ILMBASE_LIBSUFFIX} -lIexMath${ILMBASE_LIBSUFFIX} -lHalf -lIex${ILMBASE_LIBSUFFIX} -lIlmThread${ILMBASE_LIBSUFFIX} -pthread
-Cflags: -pthread -I\${OpenEXR_includedir}
-")
-
-INSTALL ( FILES
-  ${CMAKE_BINARY_DIR}/IlmBase.pc
-  DESTINATION
-  lib/pkgconfig
-)
+if ( PKG_CONFIG_FOUND )
+	configure_file(IlmBase.pc.cmake "${PROJECT_BINARY_DIR}/IlmBase.pc" @ONLY)
+	install( FILES "${PROJECT_BINARY_DIR}/IlmBase.pc" DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig COMPONENT dev )
+endif()
diff -purN a/CMakeLists.txt.orig b/CMakeLists.txt.orig
--- a/CMakeLists.txt.orig	1970-01-01 01:00:00.000000000 +0100
+++ b/CMakeLists.txt.orig	2014-08-10 05:21:45.000000000 +0100
@@ -0,0 +1,231 @@
+# yue.nicholas@gmail.com
+CMAKE_MINIMUM_REQUIRED(VERSION 2.8)
+
+PROJECT ( ilmbase )
+
+SET(ILMBASE_VERSION_MAJOR "2")
+SET(ILMBASE_VERSION_MINOR "2")
+SET(ILMBASE_VERSION_PATCH "0")
+
+SET(ILMBASE_VERSION ${ILMBASE_VERSION_MAJOR}.${ILMBASE_VERSION_MINOR}.${ILMBASE_VERSION_PATCH})
+SET(ILMBASE_VERSION_API ${ILMBASE_VERSION_MAJOR}_${ILMBASE_VERSION_MINOR})
+
+
+ENABLE_TESTING()
+
+SET(CPACK_PACKAGE_VERSION_MAJOR "${ILMBASE_VERSION_MAJOR}")
+SET(CPACK_PACKAGE_VERSION_MINOR "${ILMBASE_VERSION_MINOR}")
+SET(CPACK_PACKAGE_VERSION_PATCH "${ILMBASE_VERSION_PATCH}")
+SET(CPACK_SOURCE_GENERATOR "TGZ")
+set(CPACK_SOURCE_PACKAGE_FILE_NAME
+    "${CMAKE_PROJECT_NAME}-${ILMBASE_VERSION}"
+  )
+set(CPACK_SOURCE_IGNORE_FILES
+  "/.git*;/.cvs*;${CPACK_SOURCE_IGNORE_FILES}")
+INCLUDE ( CPack )
+
+
+# Allow the developer to select if Dynamic or Static libraries are built
+OPTION (BUILD_SHARED_LIBS "Build Shared Libraries" ON)
+
+# Allow the developer to select if Dynamic or Static libraries are built
+OPTION (NAMESPACE_VERSIONING "Namespace Versioning" ON)
+
+# Setup osx rpathing
+SET (CMAKE_MACOSX_RPATH 1)
+SET (BUILD_WITH_INSTALL_RPATH 1)
+
+IF ( NOT WIN32)
+  ADD_DEFINITIONS ( -pthread )
+ENDIF ()
+
+INCLUDE_DIRECTORIES ( Iex IexMath Imath Half ${CMAKE_CURRENT_BINARY_DIR}/config IlmThread IexTest ImathTest HalfTest )
+
+# also add the current directory to pick up the autogenerated headers
+SET(CMAKE_INCLUDE_CURRENT_DIR ON)
+
+MACRO(GET_TARGET_PROPERTY_WITH_DEFAULT _variable _target _property _default_value)
+   GET_TARGET_PROPERTY (${_variable} ${_target} ${_property})
+   IF (${_variable} MATCHES NOTFOUND)
+     SET (${_variable} ${_default_value})
+   ENDIF (${_variable} MATCHES NOTFOUND)
+ ENDMACRO (GET_TARGET_PROPERTY_WITH_DEFAULT)
+
+ MACRO(CREATE_LIBTOOL_FILE _target _install_DIR)
+   GET_TARGET_PROPERTY(_target_location ${_target} LOCATION)
+   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_static_lib ${_target} STATIC_LIB "")
+   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_dependency_libs ${_target} LT_DEPENDENCY_LIBS "")
+   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_current ${_target} LT_VERSION_CURRENT 0)
+   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_age ${_target} LT_VERSION_AGE 0)
+   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_revision ${_target} LT_VERSION_REVISION 0)
+   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_installed ${_target} LT_INSTALLED yes)
+   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_shouldnotlink ${_target} LT_SHOULDNOTLINK yes)
+   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_dlopen ${_target} LT_DLOPEN "")
+   GET_TARGET_PROPERTY_WITH_DEFAULT(_target_dlpreopen ${_target} LT_DLPREOPEN "")
+   GET_FILENAME_COMPONENT(_laname ${_target_location} NAME_WE)
+   GET_FILENAME_COMPONENT(_soname ${_target_location} NAME)
+   SET(_laname ${PROJECT_BINARY_DIR}/${_laname}.la)
+   FILE(WRITE ${_laname} "# ${_laname} - a libtool library file\n")
+   FILE(APPEND ${_laname} "# Generated by CMake ${CMAKE_VERSION} (like GNU libtool)\n")
+   FILE(APPEND ${_laname} "\n# Please DO NOT delete this file!\n# It is necessary for linking the library with libtool.\n\n" )
+   FILE(APPEND ${_laname} "# The name that we can dlopen(3).\n")
+   FILE(APPEND ${_laname} "dlname='${_soname}'\n\n")
+   FILE(APPEND ${_laname} "# Names of this library.\n")
+   FILE(APPEND ${_laname} "library_names='${_soname}.${_target_current}.${_target_age}.${_target_revision} ${_soname}.${_target_current} ${_soname}'\n\n")
+   FILE(APPEND ${_laname} "# The name of the static archive.\n")
+   FILE(APPEND ${_laname} "old_library='${_target_static_lib}'\n\n")
+   FILE(APPEND ${_laname} "# Libraries that this one depends upon.\n")
+   FILE(APPEND ${_laname} "dependency_libs='${_target_dependency_libs}'\n\n")
+   FILE(APPEND ${_laname} "# Names of additional weak libraries provided by this library\n")
+   FILE(APPEND ${_laname} "weak_library_names=\n\n")
+   FILE(APPEND ${_laname} "# Version information for ${_laname}.\n")
+   FILE(APPEND ${_laname} "current=${_target_current}\n")
+   FILE(APPEND ${_laname} "age=${_target_age}\n")
+   FILE(APPEND ${_laname} "revision=${_target_revision}\n\n")
+   FILE(APPEND ${_laname} "# Is this an already installed library?\n")
+   FILE(APPEND ${_laname} "installed=${_target_installed}\n\n")
+   FILE(APPEND ${_laname} "# Should we warn about portability when linking against -modules?\n")
+   FILE(APPEND ${_laname} "shouldnotlink=${_target_shouldnotlink}\n\n")
+   FILE(APPEND ${_laname} "# Files to dlopen/dlpreopen\n")
+   FILE(APPEND ${_laname} "dlopen='${_target_dlopen}'\n")
+   FILE(APPEND ${_laname} "dlpreopen='${_target_dlpreopen}'\n\n")
+   FILE(APPEND ${_laname} "# Directory that this library needs to be installed in:\n")
+   FILE(APPEND ${_laname} "libdir='${CMAKE_INSTALL_PREFIX}${_install_DIR}'\n")
+   INSTALL( FILES ${_laname} DESTINATION ${CMAKE_INSTALL_PREFIX}${_install_DIR})
+ ENDMACRO(CREATE_LIBTOOL_FILE)
+
+SET (LIB_TYPE STATIC)
+IF (BUILD_SHARED_LIBS)
+  # User wants to build Dynamic Libraries, so change the LIB_TYPE variable to CMake keyword 'SHARED'
+  SET (LIB_TYPE SHARED)
+  IF (WIN32)
+    ADD_DEFINITIONS(-DOPENEXR_DLL)
+  ENDIF ()
+ENDIF (BUILD_SHARED_LIBS)
+
+
+ADD_SUBDIRECTORY ( Half )
+ADD_SUBDIRECTORY ( Iex )
+ADD_SUBDIRECTORY ( IexMath )
+ADD_SUBDIRECTORY ( Imath )
+ADD_SUBDIRECTORY ( IlmThread )
+
+IF (WIN32)
+  FILE ( COPY ${CMAKE_CURRENT_SOURCE_DIR}/config.windows/IlmBaseConfig.h
+    DESTINATION ${CMAKE_CURRENT_BINARY_DIR}/config
+    )
+ELSE ()
+  IF (APPLE)
+    FILE ( WRITE  ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define HAVE_PTHREAD 1\n" )
+  ELSE ()
+    FILE ( WRITE  ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define HAVE_PTHREAD 1\n" )
+    FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define ILMBASE_HAVE_LARGE_STACK  1\n" )
+    FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define HAVE_POSIX_SEMAPHORES 1\n" )
+    FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define ILMBASE_HAVE_CONTROL_REGISTER_SUPPORT 1\n")
+  ENDIF ()
+ENDIF ()
+
+IF (NAMESPACE_VERSIONING)
+  FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define ILMBASE_INTERNAL_NAMESPACE_CUSTOM 1\n")
+  FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define IMATH_INTERNAL_NAMESPACE Imath_${ILMBASE_VERSION_API}\n")
+  FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define IEX_INTERNAL_NAMESPACE Iex_${ILMBASE_VERSION_API}\n")
+  FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define ILMTHREAD_INTERNAL_NAMESPACE IlmThread_${ILMBASE_VERSION_API}\n")
+ELSE ()
+  FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define ILMBASE_INTERNAL_NAMESPACE_CUSTOM 0\n")
+  FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define IMATH_INTERNAL_NAMESPACE Imath\n")
+  FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define IEX_INTERNAL_NAMESPACE Iex\n")
+  FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define ILMTHREAD_INTERNAL_NAMESPACE IlmThread\n")
+ENDIF ()
+
+FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define IMATH_NAMESPACE Imath\n")
+FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define IEX_NAMESPACE Iex\n")
+FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define ILMTHREAD_NAMESPACE IlmThread\n")
+FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define ILMBASE_VERSION_STRING \"${ILMBASE_VERSION}\"\n" )
+FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define ILMBASE_PACKAGE_STRING \"IlmBase ${ILMBASE_VERSION}\"\n" )
+FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define ILMBASE_VERSION_MAJOR ${ILMBASE_VERSION_MAJOR}\n" )
+FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define ILMBASE_VERSION_MINOR ${ILMBASE_VERSION_MINOR}\n" )
+FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "#define ILMBASE_VERSION_PATCH ${ILMBASE_VERSION_PATCH}\n" )
+
+FILE ( APPEND ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h "
+// Version as a single hex number, e.g. 0x01000300 == 1.0.3
+#define ILMBASE_VERSION_HEX ((ILMBASE_VERSION_MAJOR << 24) | \\
+                             (ILMBASE_VERSION_MINOR << 16) | \\
+                             (ILMBASE_VERSION_PATCH <<  8))
+")
+
+SET (ILMBASE_LIBSUFFIX "")
+IF (NAMESPACE_VERSIONING)
+  SET ( ILMBASE_LIBSUFFIX "-${ILMBASE_VERSION_API}" )
+ENDIF ()
+
+SET_TARGET_PROPERTIES ( Half
+  PROPERTIES
+  VERSION 12.0.0
+  SOVERSION 12
+  )
+SET_TARGET_PROPERTIES ( Iex
+  PROPERTIES
+  VERSION 12.0.0
+  SOVERSION 12
+  OUTPUT_NAME "Iex${ILMBASE_LIBSUFFIX}"
+  )
+SET_TARGET_PROPERTIES ( Imath
+  PROPERTIES
+  VERSION 12.0.0
+  SOVERSION 12
+  OUTPUT_NAME "Imath${ILMBASE_LIBSUFFIX}"
+  )
+SET_TARGET_PROPERTIES ( IlmThread
+  PROPERTIES
+  VERSION 12.0.0
+  SOVERSION 12
+  OUTPUT_NAME "IlmThread${ILMBASE_LIBSUFFIX}"
+  )
+SET_TARGET_PROPERTIES ( IexMath
+  PROPERTIES
+  VERSION 12.0.0
+  SOVERSION 12
+  OUTPUT_NAME "IexMath${ILMBASE_LIBSUFFIX}"
+  )
+
+IF ( NOT WIN32 )
+  CREATE_LIBTOOL_FILE ( Half /lib )
+  CREATE_LIBTOOL_FILE ( Iex /lib )
+  CREATE_LIBTOOL_FILE ( IexMath /lib )
+  CREATE_LIBTOOL_FILE ( Imath /lib )
+  CREATE_LIBTOOL_FILE ( IlmThread /lib )
+ENDIF ()
+
+# Tests
+
+ADD_SUBDIRECTORY ( HalfTest )
+ADD_SUBDIRECTORY ( IexTest )
+ADD_SUBDIRECTORY ( ImathTest )
+
+# Installation
+
+INSTALL ( FILES 
+  ${CMAKE_CURRENT_BINARY_DIR}/config/IlmBaseConfig.h
+  DESTINATION
+  include/OpenEXR
+
+)
+
+FILE ( WRITE ${CMAKE_BINARY_DIR}/IlmBase.pc "prefix=${CMAKE_INSTALL_PREFIX}\n" )
+FILE ( APPEND ${CMAKE_BINARY_DIR}/IlmBase.pc "exec_prefix=\${prefix}
+libdir=\${exec_prefix}/lib
+includedir=\${prefix}/include
+OpenEXR_includedir=\${prefix}/include/OpenEXR
+
+Name: IlmBase
+Description: Base math and exception libraries
+Version: ${ILMBASE_VERSION}
+Libs: -L\${libdir} -lImath${ILMBASE_LIBSUFFIX} -lIexMath${ILMBASE_LIBSUFFIX} -lHalf -lIex${ILMBASE_LIBSUFFIX} -lIlmThread${ILMBASE_LIBSUFFIX} -pthread
+Cflags: -pthread -I\${OpenEXR_includedir}
+")
+
+INSTALL ( FILES
+  ${CMAKE_BINARY_DIR}/IlmBase.pc
+  DESTINATION
+  lib/pkgconfig
+)
diff -purN a/Half/CMakeLists.txt b/Half/CMakeLists.txt
--- a/Half/CMakeLists.txt	2014-08-10 05:21:45.000000000 +0100
+++ b/Half/CMakeLists.txt	2017-09-18 17:19:35.500389192 +0100
@@ -46,7 +46,7 @@ ADD_DEPENDENCIES ( Half toFloat eLut )
 INSTALL ( TARGETS
   Half
   DESTINATION
-  lib
+  ${CMAKE_INSTALL_LIBDIR}
 )
 
 INSTALL ( FILES 
@@ -55,5 +55,5 @@ INSTALL ( FILES
   halfExport.h
   halfLimits.h
   DESTINATION
-  include/OpenEXR
+  ${CMAKE_INSTALL_INCLUDEDIR}/OpenEXR
 )
diff -purN a/Half/CMakeLists.txt.orig b/Half/CMakeLists.txt.orig
--- a/Half/CMakeLists.txt.orig	1970-01-01 01:00:00.000000000 +0100
+++ b/Half/CMakeLists.txt.orig	2014-08-10 05:21:45.000000000 +0100
@@ -0,0 +1,59 @@
+# yue.nicholas@gmail.com
+
+ADD_EXECUTABLE ( eLut eLut.cpp )
+
+ADD_CUSTOM_COMMAND (
+  TARGET eLut POST_BUILD
+  COMMAND eLut > ${CMAKE_CURRENT_BINARY_DIR}/eLut.h
+  WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
+)
+SET_SOURCE_FILES_PROPERTIES(
+  ${CMAKE_CURRENT_BINARY_DIR}/eLut.h
+  PROPERTIES HEADER_FILE_ONLY TRUE
+  )
+
+ADD_EXECUTABLE ( toFloat toFloat.cpp )
+ADD_CUSTOM_COMMAND (
+  TARGET toFloat POST_BUILD
+  COMMAND toFloat > ${CMAKE_CURRENT_BINARY_DIR}/toFloat.h
+  WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
+)
+SET_SOURCE_FILES_PROPERTIES(
+  ${CMAKE_CURRENT_BINARY_DIR}/toFloat.h
+  PROPERTIES HEADER_FILE_ONLY TRUE
+  )
+
+SET_SOURCE_FILES_PROPERTIES(
+  half.cpp
+  PROPERTIES
+  OBJECT_DEPENDS
+  ${CMAKE_CURRENT_BINARY_DIR}/eLut.h
+  OBJECT_DEPENDS
+  ${CMAKE_CURRENT_BINARY_DIR}/toFloat.h
+  )
+
+IF(BUILD_SHARED_LIBS)
+    ADD_DEFINITIONS(-DHALF_EXPORTS)
+ENDIF()
+
+ADD_LIBRARY ( Half ${LIB_TYPE}
+  half.cpp
+  )
+
+
+ADD_DEPENDENCIES ( Half toFloat eLut )
+
+INSTALL ( TARGETS
+  Half
+  DESTINATION
+  lib
+)
+
+INSTALL ( FILES 
+  half.h
+  halfFunction.h
+  halfExport.h
+  halfLimits.h
+  DESTINATION
+  include/OpenEXR
+)
diff -purN a/Iex/CMakeLists.txt b/Iex/CMakeLists.txt
--- a/Iex/CMakeLists.txt	2014-08-10 05:21:45.000000000 +0100
+++ b/Iex/CMakeLists.txt	2017-09-18 17:19:35.500389192 +0100
@@ -13,7 +13,7 @@ ADD_LIBRARY ( Iex ${LIB_TYPE}
 INSTALL ( TARGETS
   Iex
   DESTINATION
-  lib
+  ${CMAKE_INSTALL_LIBDIR}
 )
 
 INSTALL ( FILES 
@@ -27,5 +27,5 @@ INSTALL ( FILES
   IexExport.h
   IexForward.h
   DESTINATION
-  include/OpenEXR
+  ${CMAKE_INSTALL_INCLUDEDIR}/OpenEXR
 )
diff -purN a/IexMath/CMakeLists.txt b/IexMath/CMakeLists.txt
--- a/IexMath/CMakeLists.txt	2014-08-10 05:21:45.000000000 +0100
+++ b/IexMath/CMakeLists.txt	2017-09-18 17:19:35.500389192 +0100
@@ -12,7 +12,7 @@ TARGET_LINK_LIBRARIES(IexMath Iex)
 INSTALL ( TARGETS
   IexMath
   DESTINATION
-  lib
+  ${CMAKE_INSTALL_LIBDIR}
 )
 
 INSTALL ( FILES 
@@ -20,5 +20,5 @@ INSTALL ( FILES
   IexMathFpu.h  
   IexMathIeeeExc.h
   DESTINATION
-  include/OpenEXR
+  ${CMAKE_INSTALL_INCLUDEDIR}/OpenEXR
 )
diff -purN a/IlmBase.pc.cmake b/IlmBase.pc.cmake
--- a/IlmBase.pc.cmake	1970-01-01 01:00:00.000000000 +0100
+++ b/IlmBase.pc.cmake	2017-09-18 17:19:35.500389192 +0100
@@ -0,0 +1,9 @@
+libdir=@CMAKE_INSTALL_FULL_LIBDIR@
+includedir=@CMAKE_INSTALL_FULL_INCLUDEDIR@
+OpenEXR_includedir=@CMAKE_INSTALL_FULL_INCLUDEDIR@/OpenEXR
+
+Name: IlmBase
+Description: Base math and exception libraries
+Version: @ILMBASE_VERSION@
+Libs: -L${libdir} -lHalf -lIex@ILMBASE_LIBSUFFIX@ -lIexMath@ILMBASE_LIBSUFFIX@ -lIlmThread@ILMBASE_LIBSUFFIX@ -lImath@ILMBASE_LIBSUFFIX@ @CMAKE_THREAD_LIBS_INIT@
+Cflags: @CMAKE_THREAD_LIBS_INIT@ -I${OpenEXR_includedir}
diff -purN a/IlmThread/CMakeLists.txt b/IlmThread/CMakeLists.txt
--- a/IlmThread/CMakeLists.txt	2014-08-10 05:21:45.000000000 +0100
+++ b/IlmThread/CMakeLists.txt	2017-09-18 17:19:35.500389192 +0100
@@ -31,7 +31,7 @@ TARGET_LINK_LIBRARIES(IlmThread Iex)
 INSTALL ( TARGETS
   IlmThread
   DESTINATION
-  lib
+  ${CMAKE_INSTALL_LIBDIR}
 )
 
 INSTALL ( FILES 
@@ -43,5 +43,5 @@ INSTALL ( FILES
   IlmThreadExport.h
   IlmThreadForward.h
   DESTINATION
-  include/OpenEXR
+  ${CMAKE_INSTALL_INCLUDEDIR}/OpenEXR
 )
diff -purN a/Imath/CMakeLists.txt b/Imath/CMakeLists.txt
--- a/Imath/CMakeLists.txt	2014-08-10 05:21:45.000000000 +0100
+++ b/Imath/CMakeLists.txt	2017-09-18 17:19:35.501389194 +0100
@@ -19,7 +19,7 @@ TARGET_LINK_LIBRARIES(Imath Iex)
 INSTALL ( TARGETS
   Imath
   DESTINATION
-  lib
+  ${CMAKE_INSTALL_LIBDIR}
 )
 
 INSTALL ( FILES 
@@ -57,5 +57,5 @@ INSTALL ( FILES
   ImathVecAlgo.h
   ImathVec.h
   DESTINATION
-  include/OpenEXR
+  ${CMAKE_INSTALL_INCLUDEDIR}/OpenEXR
 )
